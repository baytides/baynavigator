---
/**
 * Toast notification component
 * Displays success, error, warning, and info messages
 * Accessible with ARIA live regions
 */
---

<div
  id="toast-container"
  class="fixed bottom-20 right-4 z-50 flex flex-col gap-2 pointer-events-none"
  aria-live="polite"
  aria-atomic="true"
>
  <!-- Toast notifications will be inserted here by JavaScript -->
</div>

<template id="toast-template">
  <div
    class="toast pointer-events-auto max-w-sm w-full bg-white dark:bg-neutral-800 shadow-lg rounded-lg overflow-hidden transform translate-x-full transition-transform duration-300 ease-out"
    role="alert"
  >
    <div class="p-4 flex items-start gap-3">
      <div class="toast-icon flex-shrink-0"></div>
      <div class="flex-1 min-w-0">
        <p class="toast-title font-medium text-neutral-900 dark:text-white"></p>
        <p class="toast-message text-sm text-neutral-600 dark:text-neutral-300 mt-1"></p>
      </div>
      <button
        type="button"
        class="toast-dismiss flex-shrink-0 p-1 rounded hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors"
        aria-label="Dismiss notification"
      >
        <svg class="w-5 h-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <div
      class="toast-progress h-1 bg-current opacity-30 origin-left scale-x-100 transition-transform duration-linear"
    >
    </div>
  </div>
</template>

<script>
  interface ToastOptions {
    type?: 'success' | 'error' | 'warning' | 'info';
    title?: string;
    message: string;
    duration?: number;
  }

  const icons = {
    success: `<svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>`,
    error: `<svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>`,
    warning: `<svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
    </svg>`,
    info: `<svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>`,
  };

  const colors = {
    success: 'text-green-600',
    error: 'text-red-600',
    warning: 'text-amber-600',
    info: 'text-blue-600',
  };

  function showToast(options: ToastOptions) {
    const container = document.getElementById('toast-container');
    const template = document.getElementById('toast-template') as HTMLTemplateElement;

    if (!container || !template) return;

    const { type = 'info', title, message, duration = 5000 } = options;

    const clone = template.content.cloneNode(true) as DocumentFragment;
    const toast = clone.querySelector('.toast') as HTMLElement;
    const iconEl = toast.querySelector('.toast-icon') as HTMLElement;
    const titleEl = toast.querySelector('.toast-title') as HTMLElement;
    const messageEl = toast.querySelector('.toast-message') as HTMLElement;
    const dismissBtn = toast.querySelector('.toast-dismiss') as HTMLElement;
    const progressBar = toast.querySelector('.toast-progress') as HTMLElement;

    // Set content
    iconEl.innerHTML = icons[type];
    if (title) {
      titleEl.textContent = title;
    } else {
      titleEl.remove();
    }
    messageEl.textContent = message;
    progressBar.classList.add(colors[type]);

    // Add to container
    container.appendChild(toast);

    // Trigger animation
    requestAnimationFrame(() => {
      toast.classList.remove('translate-x-full');
      toast.classList.add('translate-x-0');
    });

    // Progress bar animation
    progressBar.style.transitionDuration = `${duration}ms`;
    requestAnimationFrame(() => {
      progressBar.classList.remove('scale-x-100');
      progressBar.classList.add('scale-x-0');
    });

    // Auto dismiss
    const dismissTimeout = setTimeout(() => dismiss(), duration);

    function dismiss() {
      clearTimeout(dismissTimeout);
      toast.classList.remove('translate-x-0');
      toast.classList.add('translate-x-full');
      setTimeout(() => toast.remove(), 300);
    }

    // Manual dismiss
    dismissBtn.addEventListener('click', dismiss);

    // Pause on hover
    toast.addEventListener('mouseenter', () => {
      progressBar.style.animationPlayState = 'paused';
    });
    toast.addEventListener('mouseleave', () => {
      progressBar.style.animationPlayState = 'running';
    });
  }

  // Expose to global scope
  (window as any).showToast = showToast;

  // Helper functions
  (window as any).toast = {
    success: (message: string, title?: string) => showToast({ type: 'success', message, title }),
    error: (message: string, title?: string) => showToast({ type: 'error', message, title }),
    warning: (message: string, title?: string) => showToast({ type: 'warning', message, title }),
    info: (message: string, title?: string) => showToast({ type: 'info', message, title }),
  };
</script>

<style>
  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .toast {
      transition: none;
    }
    .toast-progress {
      transition: none;
    }
  }
</style>
