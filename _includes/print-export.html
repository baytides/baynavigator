<!-- Print/Export Feature -->
<div class="print-export-controls" role="group" aria-label="Export options">
  <button type="button" class="export-btn" id="print-programs" aria-label="Print selected programs">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <polyline points="6 9 6 2 18 2 18 9"></polyline>
      <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
      <rect x="6" y="14" width="12" height="8"></rect>
    </svg>
    <span>Print List</span>
  </button>
  <button type="button" class="export-btn" id="export-pdf" aria-label="Export as PDF">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="12" y1="18" x2="12" y2="12"></line>
      <line x1="9" y1="15" x2="15" y2="15"></line>
    </svg>
    <span>Save PDF</span>
  </button>
</div>

<!-- Print-only header with branding (hidden on screen) -->
<div class="print-header" aria-hidden="true">
  <img src="{{ '/assets/images/logo/banner.svg' | relative_url }}" alt="Bay Navigator" class="print-logo">
  <div class="print-tagline">Free & Discounted Programs for Bay Area Residents</div>
  <div class="print-url">baynavigator.org</div>
  <div class="print-date">Generated: <span id="print-date"></span></div>
</div>

<!-- Print-only footer with branding -->
<div class="print-footer" aria-hidden="true">
  <div class="print-footer-content">
    <p><strong>Bay Navigator</strong> is a community project helping residents find free and low-cost resources.</p>
    <p>Visit <strong>baynavigator.org</strong> for the most up-to-date information.</p>
    <p class="print-disclaimer">Program details may change. Always verify eligibility on the official program website.</p>
  </div>
</div>

<style>
/* Print/Export Controls */
.print-export-controls {
  display: flex;
  gap: 0.5rem;
  margin: 1rem 0;
  flex-wrap: wrap;
}

.export-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.625rem 1rem;
  font-size: 0.875rem;
  font-weight: 500;
  color: #374151;
  background: white;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  min-height: 44px;
}

.export-btn:hover {
  background: #f3f4f6;
  border-color: #9ca3af;
}

.export-btn:focus {
  outline: 3px solid #2563eb;
  outline-offset: 2px;
}

/* Print-only elements (hidden on screen) */
.print-header,
.print-footer {
  display: none;
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .export-btn {
    background: #374151;
    color: #f3f4f6;
    border-color: #4b5563;
  }

  .export-btn:hover {
    background: #4b5563;
    border-color: #6b7280;
  }
}

body[data-theme="dark"] .export-btn {
  background: #374151;
  color: #f3f4f6;
  border-color: #4b5563;
}

body[data-theme="dark"] .export-btn:hover {
  background: #4b5563;
  border-color: #6b7280;
}

/* Print Styles */
@media print {
  /* Hide non-essential elements */
  .site-header,
  .utility-bar,
  footer,
  .mobile-bottom-nav,
  .mobile-filter-toggle,
  .search-panel,
  .filters-section,
  .print-export-controls,
  .export-btn,
  .favorite-toggle,
  .copy-link-btn,
  .program-details,
  .step-flow-page,
  .accessibility-toolbar,
  .skip-link,
  .simple-language-benefit,
  .program-link,
  .filter-controls,
  .results-header,
  #search-empty-state {
    display: none !important;
  }

  /* Show print header and footer */
  .print-header,
  .print-footer {
    display: block !important;
  }

  /* Print header styling */
  .print-header {
    text-align: center;
    padding: 1rem 0 1.5rem;
    border-bottom: 2px solid #2563eb;
    margin-bottom: 1.5rem;
  }

  .print-logo {
    max-width: 280px;
    height: auto;
    margin-bottom: 0.5rem;
  }

  .print-tagline {
    font-size: 14pt;
    color: #374151;
    margin-bottom: 0.25rem;
  }

  .print-url {
    font-size: 12pt;
    font-weight: 600;
    color: #2563eb;
    margin-bottom: 0.5rem;
  }

  .print-date {
    font-size: 10pt;
    color: #6b7280;
  }

  /* Print footer styling */
  .print-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1rem;
    border-top: 1px solid #e5e7eb;
    background: white;
    font-size: 9pt;
    text-align: center;
  }

  .print-footer-content p {
    margin: 0.25rem 0;
    color: #374151;
  }

  .print-disclaimer {
    font-style: italic;
    color: #6b7280 !important;
    margin-top: 0.5rem !important;
  }

  /* Program card print styling */
  .program-card {
    page-break-inside: avoid;
    border: 1px solid #e5e7eb !important;
    box-shadow: none !important;
    margin-bottom: 1rem;
    padding: 1rem;
  }

  .program-name {
    font-size: 12pt;
    color: #111827;
  }

  .program-benefit {
    font-size: 10pt;
    color: #374151;
  }

  .eligibility-badges {
    font-size: 9pt;
  }

  .program-meta {
    font-size: 9pt;
    color: #6b7280;
  }

  .program-footer {
    display: none !important;
  }

  /* Show program URL in print */
  .program-card::after {
    content: attr(data-program-url);
    display: block;
    font-size: 9pt;
    color: #2563eb;
    margin-top: 0.5rem;
    word-break: break-all;
  }

  /* Page margins */
  @page {
    margin: 0.75in;
    size: letter;
  }

  /* Ensure good contrast */
  body {
    color: #111827 !important;
    background: white !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  #search-results {
    display: block !important;
  }

  .programs-container {
    display: block !important;
  }

  /* Add page numbers */
  @page {
    @bottom-center {
      content: "Page " counter(page) " of " counter(pages);
      font-size: 9pt;
      color: #6b7280;
    }
  }
}
</style>

<script>
(function() {
  const printBtn = document.getElementById('print-programs');
  const pdfBtn = document.getElementById('export-pdf');
  const printDateEl = document.getElementById('print-date');

  // Set print date
  if (printDateEl) {
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    printDateEl.textContent = new Date().toLocaleDateString('en-US', options);
  }

  // Add program URLs as data attributes for print
  function addProgramURLs() {
    document.querySelectorAll('.program-card').forEach(card => {
      const link = card.querySelector('.program-link');
      if (link) {
        card.setAttribute('data-program-url', link.href.split('?')[0]); // Remove UTM params
      }
    });
  }

  // Print functionality
  if (printBtn) {
    printBtn.addEventListener('click', () => {
      addProgramURLs();

      // Count visible programs
      const visiblePrograms = document.querySelectorAll('.program-card:not([style*="display: none"])');
      if (visiblePrograms.length === 0) {
        alert('No programs to print. Try adjusting your filters.');
        return;
      }

      // Trigger print dialog
      window.print();
    });
  }

  // PDF export (uses browser's Save as PDF)
  if (pdfBtn) {
    pdfBtn.addEventListener('click', () => {
      addProgramURLs();

      // Count visible programs
      const visiblePrograms = document.querySelectorAll('.program-card:not([style*="display: none"])');
      if (visiblePrograms.length === 0) {
        alert('No programs to export. Try adjusting your filters.');
        return;
      }

      // Show instruction for PDF
      alert('In the print dialog that opens:\n\n1. Select "Save as PDF" as your destination\n2. Click "Save"\n\nThe PDF will include the Bay Navigator branding.');

      window.print();
    });
  }

  // Listen for print event to update date
  window.addEventListener('beforeprint', () => {
    if (printDateEl) {
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      printDateEl.textContent = new Date().toLocaleDateString('en-US', options);
    }
    addProgramURLs();
  });
})();
</script>
