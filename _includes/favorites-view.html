<!-- Print-only header for favorites -->
<div class="print-favorites-header" aria-hidden="true">
  <h1>My Saved Programs</h1>
  <p>Bay Navigator - baynavigator.org</p>
  <p class="print-date">Generated: <span id="favorites-print-date"></span></p>
</div>

<div id="favorites-view" class="favorites-view" style="display: none;">
  <div class="favorites-header">
    <h2>My Saved Programs</h2>
    <div class="favorites-actions">
      <button id="clear-favorites" class="btn-secondary" type="button">Clear All</button>
      <button id="close-favorites" class="btn-primary" type="button">Back to All Programs</button>
    </div>
  </div>

  <!-- Print/Export Controls - Only for saved programs -->
  <div class="print-export-controls favorites-export" role="group" aria-label="Export saved programs">
    <button type="button" class="export-btn" id="print-favorites" aria-label="Print saved programs list">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <polyline points="6 9 6 2 18 2 18 9"></polyline>
        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
        <rect x="6" y="14" width="12" height="8"></rect>
      </svg>
      <span>Print List</span>
    </button>
    <button type="button" class="export-btn" id="export-favorites-pdf" aria-label="Save saved programs as PDF">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="12" y1="18" x2="12" y2="12"></line>
        <line x1="9" y1="15" x2="15" y2="15"></line>
      </svg>
      <span>Save PDF</span>
    </button>
  </div>

  <div id="favorites-list" class="favorites-list">
    <!-- Favorites will be rendered here -->
  </div>
  
  <div id="no-favorites" class="no-results" style="display: none;">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.3; margin-bottom: 1rem;">
      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
    </svg>
        <h3 data-i18n="favorites.empty">No saved programs yet</h3>
        <p data-i18n="favorites.empty_hint">Click the heart icon on any program to save it here</p>
  </div>
</div>

<!-- Favorites toggle button in header -->
<button id="view-favorites" class="favorites-toggle-btn" type="button" aria-label="View saved programs" aria-pressed="false">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
  </svg>
  <span>Saved</span>
  <span id="favorites-count" class="favorites-count" role="status" aria-live="polite">0</span>
</button>

<!-- Styles moved to /assets/css/components.css -->

<script>
(function() {
  let initialized = false;

  const init = () => {
    if (initialized) return;
    const viewFavoritesBtn = document.getElementById('view-favorites');
    const closeFavoritesBtn = document.getElementById('close-favorites');
    const clearFavoritesBtn = document.getElementById('clear-favorites');
    const printFavoritesBtn = document.getElementById('print-favorites');
    const exportPdfBtn = document.getElementById('export-favorites-pdf');
    const favoritesView = document.getElementById('favorites-view');
    const favoritesList = document.getElementById('favorites-list');
    const noFavorites = document.getElementById('no-favorites');
    const printDateEl = document.getElementById('favorites-print-date');
    const mainContent = document.getElementById('search-results') || document.getElementById('results');
    const searchPanel = document.querySelector('.search-panel');

    if (!viewFavoritesBtn || !favoritesView || !favoritesList || !noFavorites) return;
    if (!window.favorites) return;

    initialized = true;

    // Set print date
    function updatePrintDate() {
      if (printDateEl) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        printDateEl.textContent = new Date().toLocaleDateString('en-US', options);
      }
    }

    // Show favorites view
    viewFavoritesBtn.addEventListener('click', function() {
      renderFavorites();
      favoritesView.style.display = 'block';
      viewFavoritesBtn.setAttribute('aria-pressed', 'true');
      if (mainContent) mainContent.style.display = 'none';
      if (searchPanel) searchPanel.style.display = 'none';
    });

    // Close favorites view
    if (closeFavoritesBtn) {
      closeFavoritesBtn.addEventListener('click', function() {
        favoritesView.style.display = 'none';
        viewFavoritesBtn.setAttribute('aria-pressed', 'false');
        if (mainContent) mainContent.style.display = '';
        if (searchPanel) searchPanel.style.display = '';
      });
    }

    // Clear all favorites
    if (clearFavoritesBtn) {
      clearFavoritesBtn.addEventListener('click', function() {
        if (confirm('Are you sure you want to remove all saved programs?')) {
          window.favorites.clear();
          renderFavorites();
        }
      });
    }

    // Print favorites
    if (printFavoritesBtn) {
      printFavoritesBtn.addEventListener('click', function() {
        const favs = typeof window.favorites.list === 'function' ? window.favorites.list() : [];
        if (favs.length === 0) {
          alert('No saved programs to print. Save some programs first by clicking the heart icon.');
          return;
        }
        updatePrintDate();
        window.print();
      });
    }

    // Export favorites as PDF
    if (exportPdfBtn) {
      exportPdfBtn.addEventListener('click', function() {
        const favs = typeof window.favorites.list === 'function' ? window.favorites.list() : [];
        if (favs.length === 0) {
          alert('No saved programs to export. Save some programs first by clicking the heart icon.');
          return;
        }
        updatePrintDate();
        alert('In the print dialog that opens:\n\n1. Select "Save as PDF" as your destination\n2. Click "Save"\n\nYour saved programs will be exported with Bay Navigator branding.');
        window.print();
      });
    }

    // Update date before printing
    window.addEventListener('beforeprint', updatePrintDate);

    // Render favorites (lightweight list, no cloning)
    function renderFavorites() {
      const favs = typeof window.favorites.list === 'function' ? window.favorites.list() : [];

      if (!favs.length) {
        favoritesList.innerHTML = '';
        noFavorites.style.display = 'block';
        return;
      }

      noFavorites.style.display = 'none';

      const items = favs
        .map(f => `<div class="favorite-row favorites-card"><h3>${f.title}</h3><p><a href="${f.url}">${f.linkText}</a></p></div>`)
        .join('');

      favoritesList.innerHTML = items;
    }

    document.addEventListener('favoritesUpdated', renderFavorites);
  };

  if (window.favorites) {
    init();
  } else {
    document.addEventListener('favoritesReady', init, { once: true });
  }
})();
</script>
