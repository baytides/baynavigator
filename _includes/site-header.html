<header class="site-header">
  <h1 class="sr-only">Bay Navigator</h1>
  <div class="header-container">
    <a href="{{ site.baseurl | default: '' }}/?no-step=1" class="site-logo" aria-label="Bay Navigator - Home">
      <img src="{{ site.baseurl | default: '' }}/assets/images/logo/banner.svg"
           alt="Bay Navigator">
    </a>

    <nav class="site-nav" aria-label="Main navigation">
      <ul class="nav-menu">
        <li>
          <a href="{{ site.baseurl | default: '' }}/?no-step=1"
             class="nav-link"
             {% if page.url == '/' or page.url == '/index.html' %}aria-current="page"{% endif %}>
            All Programs
            <span class="simple-language-nav-label">Browse all discounts</span>
          </a>
        </li>
        <li>
          <a href="{{ site.baseurl | default: '' }}/about.html"
             class="nav-link"
             {% if page.url == '/about.html' %}aria-current="page"{% endif %}>
            About
            <span class="simple-language-nav-label">Who made this</span>
          </a>
        </li>
        <li class="nav-dropdown">
          <button class="nav-link nav-dropdown-toggle"
                  type="button"
                  aria-expanded="false"
                  aria-haspopup="true"
                  {% if page.url contains '/eligibility/' %}aria-current="page"{% endif %}>
            Eligibility Guides
            <span class="simple-language-nav-label">Do I qualify?</span>
            <span class="dropdown-arrow" aria-hidden="true">&#9662;</span>
          </button>
          <ul class="nav-dropdown-menu" role="menu">
            <li role="none">
              <a href="{{ site.baseurl | default: '' }}/eligibility/"
                 role="menuitem"
                 {% if page.url == '/eligibility/' or page.url == '/eligibility/index.html' %}aria-current="page"{% endif %}>
                All Guides
              </a>
            </li>
            <li role="none">
              <a href="{{ site.baseurl | default: '' }}/eligibility/public-assistance.html"
                 role="menuitem"
                 {% if page.url == '/eligibility/public-assistance.html' %}aria-current="page"{% endif %}>
                Public Assistance
              </a>
            </li>
            <li role="none">
              <a href="{{ site.baseurl | default: '' }}/eligibility/military-veterans.html"
                 role="menuitem"
                 {% if page.url == '/eligibility/military-veterans.html' %}aria-current="page"{% endif %}>
                Military &amp; Veterans
              </a>
            </li>
            <li role="none">
              <a href="{{ site.baseurl | default: '' }}/eligibility/students.html"
                 role="menuitem"
                 {% if page.url == '/eligibility/students.html' %}aria-current="page"{% endif %}>
                Students
              </a>
            </li>
            <li role="none">
              <a href="{{ site.baseurl | default: '' }}/eligibility/seniors.html"
                 role="menuitem"
                 {% if page.url == '/eligibility/seniors.html' %}aria-current="page"{% endif %}>
                Seniors
              </a>
            </li>
            <li role="none">
              <a href="{{ site.baseurl | default: '' }}/eligibility/disability.html"
                 role="menuitem"
                 {% if page.url == '/eligibility/disability.html' %}aria-current="page"{% endif %}>
                Disability
              </a>
            </li>
            <li role="none">
              <a href="{{ site.baseurl | default: '' }}/eligibility/utility-programs.html"
                 role="menuitem"
                 {% if page.url == '/eligibility/utility-programs.html' %}aria-current="page"{% endif %}>
                Utility Programs
              </a>
            </li>
          </ul>
        </li>
        <li>
          <a href="{{ site.baseurl | default: '' }}/favorites.html"
             class="nav-link"
             {% if page.url == '/favorites.html' %}aria-current="page"{% endif %}>
            Saved Programs
            <span class="simple-language-nav-label">Your favorites</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</header>

<style>
.site-header {
  padding: 0.75rem 0 0.5rem;
  margin-bottom: 0.75rem;
}

.header-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
}

.site-logo {
  text-align: center;
  display: block;
  text-decoration: none;
  flex-shrink: 0;
}

.site-logo img {
  max-width: 200px;
  height: auto;
  display: block;
  margin: 0;
  transition: opacity 0.2s ease;
}

.site-logo:hover img {
  opacity: 0.85;
}

.site-nav {
  flex: 1;
}

.nav-menu {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: flex-end;
  gap: 0.25rem;
  flex-wrap: wrap;
}

.nav-link {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.5rem 0.875rem;
  min-height: 36px;
  font-size: 0.875rem;
  font-weight: 500;
  color: #374151;
  text-decoration: none;
  border-radius: 0.375rem;
  transition: all 0.2s ease;
  border: 1px solid transparent;
  text-align: center;
  white-space: nowrap;
  background: transparent;
  cursor: pointer;
}

.nav-link:hover {
  background: #f3f4f6;
  color: #2563eb;
  text-decoration: none;
}

.nav-link:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* Active page styling */
.nav-link[aria-current="page"] {
  background: #2563eb;
  color: white;
  font-weight: 600;
}

.nav-link[aria-current="page"]:hover {
  background: #1e40af;
  color: white;
}

/* Dropdown styles */
.nav-dropdown {
  position: relative;
}

.dropdown-arrow {
  font-size: 0.7rem;
  transition: transform 0.2s ease;
}

.nav-dropdown-toggle[aria-expanded="true"] .dropdown-arrow {
  transform: rotate(180deg);
}

.nav-dropdown-menu {
  display: none;
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  min-width: 200px;
  margin: 0;
  padding: 0.5rem 0;
  list-style: none;
  background: #ffffff;
  border-radius: 0.5rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 1000;
}

.nav-dropdown-menu[data-open="true"] {
  display: block;
}

.nav-dropdown-menu a {
  display: block;
  padding: 0.75rem 1.25rem;
  color: #374151;
  text-decoration: none;
  font-size: 0.95rem;
  transition: background 0.15s ease;
}

.nav-dropdown-menu a:hover {
  background: #f3f4f6;
  color: #2563eb;
}

.nav-dropdown-menu a:focus {
  outline: none;
  background: #e5e7eb;
}

.nav-dropdown-menu a[aria-current="page"] {
  background: #eff6ff;
  color: #2563eb;
  font-weight: 500;
}

/* Mobile optimizations */
@media (max-width: 768px) {
  .header-container {
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .site-logo img {
    max-width: 180px;
  }

  .nav-menu {
    justify-content: center;
    gap: 0.25rem;
  }

  .nav-link {
    padding: 0.375rem 0.625rem;
    font-size: 0.8125rem;
    min-height: 32px;
  }

  .nav-dropdown-menu {
    position: fixed;
    left: 1rem;
    right: 1rem;
    transform: none;
    max-width: calc(100vw - 2rem);
  }
}

/* Hide "simple language" labels to save space */
.simple-language-nav-label {
  display: none;
}

/* Dark mode - system preference */
@media (prefers-color-scheme: dark) {
  .nav-link {
    color: var(--text-link, #79d8eb);
  }

  .nav-link:hover {
    background: #30363d;
    color: var(--text-link-hover, #a8e6f1);
  }

  .nav-link[aria-current="page"] {
    background: #2563eb;
    color: white;
  }

  .nav-link[aria-current="page"]:hover {
    background: #1e40af;
  }

  .nav-dropdown-menu {
    background: #1f2937;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }

  .nav-dropdown-menu a {
    color: var(--text-link, #79d8eb);
  }

  .nav-dropdown-menu a:hover {
    background: #374151;
    color: var(--text-link-hover, #a8e6f1);
  }

  .nav-dropdown-menu a:focus {
    background: #374151;
  }

  .nav-dropdown-menu a[aria-current="page"] {
    background: #1e3a5f;
    color: #79d8eb;
  }
}

/* Dark mode - manual toggle */
body[data-theme="dark"] .nav-link {
  color: var(--text-link, #79d8eb);
}

body[data-theme="dark"] .nav-link:hover {
  background: #30363d;
  color: var(--text-link-hover, #a8e6f1);
}

body[data-theme="dark"] .nav-link[aria-current="page"] {
  background: #2563eb;
  color: white;
}

body[data-theme="dark"] .nav-link[aria-current="page"]:hover {
  background: #1e40af;
}

body[data-theme="dark"] .nav-dropdown-menu {
  background: #1f2937;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

body[data-theme="dark"] .nav-dropdown-menu a {
  color: var(--text-link, #79d8eb);
}

body[data-theme="dark"] .nav-dropdown-menu a:hover {
  background: #374151;
  color: var(--text-link-hover, #a8e6f1);
}

body[data-theme="dark"] .nav-dropdown-menu a:focus {
  background: #374151;
}

body[data-theme="dark"] .nav-dropdown-menu a[aria-current="page"] {
  background: #1e3a5f;
  color: #79d8eb;
}

/* Light mode - manual toggle (reset to light colors) */
body[data-theme="light"] .nav-link {
  color: #374151;
}

body[data-theme="light"] .nav-link:hover {
  background: #f3f4f6;
  color: #2563eb;
}

body[data-theme="light"] .nav-dropdown-menu {
  background: #ffffff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

body[data-theme="light"] .nav-dropdown-menu a {
  color: #374151;
}

body[data-theme="light"] .nav-dropdown-menu a:hover {
  background: #f3f4f6;
  color: #2563eb;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const dropdownToggle = document.querySelector('.nav-dropdown-toggle');
  const dropdownMenu = document.querySelector('.nav-dropdown-menu');

  if (!dropdownToggle || !dropdownMenu) return;

  // Toggle dropdown on click
  dropdownToggle.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    const isExpanded = this.getAttribute('aria-expanded') === 'true';
    const newState = !isExpanded;
    this.setAttribute('aria-expanded', newState ? 'true' : 'false');
    dropdownMenu.setAttribute('data-open', newState ? 'true' : 'false');
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.nav-dropdown')) {
      dropdownToggle.setAttribute('aria-expanded', 'false');
      dropdownMenu.setAttribute('data-open', 'false');
    }
  });

  // Keyboard navigation
  dropdownToggle.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      this.click();
    } else if (e.key === 'ArrowDown') {
      e.preventDefault();
      const isExpanded = this.getAttribute('aria-expanded') === 'true';
      if (!isExpanded) {
        this.click();
      }
      const firstItem = dropdownMenu.querySelector('a');
      if (firstItem) firstItem.focus();
    } else if (e.key === 'Escape') {
      this.setAttribute('aria-expanded', 'false');
      dropdownMenu.setAttribute('data-open', 'false');
    }
  });

  // Arrow key navigation within dropdown
  dropdownMenu.addEventListener('keydown', function(e) {
    const items = Array.from(this.querySelectorAll('a'));
    const currentIndex = items.indexOf(document.activeElement);

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      const nextIndex = (currentIndex + 1) % items.length;
      items[nextIndex].focus();
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      const prevIndex = currentIndex <= 0 ? items.length - 1 : currentIndex - 1;
      items[prevIndex].focus();
    } else if (e.key === 'Escape') {
      dropdownToggle.setAttribute('aria-expanded', 'false');
      dropdownMenu.setAttribute('data-open', 'false');
      dropdownToggle.focus();
    } else if (e.key === 'Tab' && !e.shiftKey && currentIndex === items.length - 1) {
      dropdownToggle.setAttribute('aria-expanded', 'false');
      dropdownMenu.setAttribute('data-open', 'false');
    }
  });

  // Close on focus out
  document.querySelector('.nav-dropdown').addEventListener('focusout', function(e) {
    setTimeout(() => {
      if (!this.contains(document.activeElement)) {
        dropdownToggle.setAttribute('aria-expanded', 'false');
        dropdownMenu.setAttribute('data-open', 'false');
      }
    }, 0);
  });
});
</script>
